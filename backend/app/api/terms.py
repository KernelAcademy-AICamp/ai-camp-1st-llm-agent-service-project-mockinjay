"""
Terms of Service API Router
Provides cached terms and conditions content
"""
from fastapi import APIRouter
from pydantic import BaseModel
from typing import Dict, Any
import logging

logger = logging.getLogger(__name__)

router = APIRouter(prefix="/api/terms", tags=["terms"])

# Cached terms content (replacing 건양대학교병원 with CarePlus)
TERMS_CONTENT = {
    "service_terms": {
        "title": "서비스 이용약관",
        "required": True,
        "content": """
제1장 총칙

제1조 (목적)
본 약관은 CarePlus(이하 "회사"라 함)가 제공하는 헬스케어 서비스(이하 "서비스"라 함)의 이용과 관련하여 회사와 회원 간의 권리, 의무 및 책임사항, 기타 필요한 사항을 규정함을 목적으로 합니다.

제2조 (용어의 정의)
1. "서비스"라 함은 회사가 제공하는 만성콩팥병 관리, 건강 상담, 의료정보 제공 등의 온라인 헬스케어 서비스를 의미합니다.
2. "회원"이라 함은 본 약관에 동의하고 회사와 서비스 이용계약을 체결한 자를 말합니다.
3. "아이디(ID)"라 함은 회원의 식별과 서비스 이용을 위하여 회원이 정하고 회사가 승인하는 문자 또는 숫자의 조합을 의미합니다.
4. "비밀번호"라 함은 회원이 부여받은 아이디와 일치되는 회원임을 확인하고 비밀의 보호를 위해 회원 자신이 정한 문자 또는 숫자의 조합을 의미합니다.

제3조 (약관의 명시 및 개정)
1. 회사는 본 약관의 내용을 회원이 쉽게 알 수 있도록 서비스 초기 화면에 게시합니다.
2. 회사는 필요한 경우 관련 법령을 위배하지 않는 범위에서 본 약관을 개정할 수 있습니다.
3. 회사가 약관을 개정할 경우에는 적용일자 및 개정사유를 명시하여 현행약관과 함께 서비스 초기화면에 그 적용일자 7일 이전부터 적용일자 전일까지 공지합니다.

제2장 회원가입 및 탈퇴

제4조 (회원가입)
1. 회원가입은 이용자가 약관의 내용에 대하여 동의를 한 다음 회원가입 신청을 하고 회사가 이러한 신청에 대하여 승낙함으로써 체결됩니다.
2. 회원가입 신청 시 이용자는 실명으로 회원가입을 하여야 합니다.
3. 회사는 다음 각 호에 해당하는 회원가입 신청에 대하여는 승낙을 거부할 수 있습니다.
   - 실명이 아니거나 타인의 명의를 이용한 경우
   - 허위의 정보를 기재하거나, 회사가 제시하는 내용을 기재하지 않은 경우
   - 이용자의 귀책사유로 인하여 승인이 불가능하거나 기타 규정한 제반 사항을 위반하며 신청하는 경우

제5조 (회원탈퇴)
1. 회원은 언제든지 서비스 이용을 원하지 않는 경우 회원 탈퇴를 요청할 수 있으며, 회사는 즉시 회원탈퇴를 처리합니다.
2. 회원탈퇴 시 회원의 모든 정보(아이디 제외)는 삭제되며, 복구할 수 없습니다.

제3장 개인정보보호

제6조 (개인정보의 보호 및 사용)
1. 회사는 관련법령이 정하는 바에 따라 회원의 개인정보를 보호하기 위해 노력합니다.
2. 회사는 서비스 제공을 위하여 필요한 최소한의 정보를 수집합니다.
3. 회사는 회원의 개인정보를 본인의 승낙 없이 타인에게 누설, 배포하지 않습니다.

제4장 서비스 이용 책임

제7조 (서비스 제공)
1. 회사는 안정적인 서비스 제공을 위하여 최선을 다합니다.
2. 회사는 서비스 이용과 관련하여 회원으로부터 제기된 의견이나 불만이 정당하다고 인정될 경우 이를 처리하여야 합니다.

제5장 회사와 이용자의 의무

제8조 (회사의 의무)
1. 회사는 지속적이고 안정적인 서비스의 제공을 위하여 최선을 다합니다.
2. 회사는 회원의 개인정보 보호를 위한 보안시스템을 구축하며 개인정보 보호정책을 공시하고 준수합니다.

제9조 (회원의 의무)
1. 회원은 관계법령, 본 약관의 규정, 이용안내 및 서비스와 관련하여 공지한 주의사항 등을 준수하여야 합니다.
2. 회원은 회사의 사전 승낙 없이 서비스를 이용하여 어떠한 영리행위도 할 수 없습니다.

제6장 기타

제10조 (저작권)
회사가 작성한 저작물에 대한 저작권 기타 지적재산권은 회사에 귀속합니다.

제11조 (분쟁의 해결)
1. 회사와 회원은 서비스와 관련하여 발생한 분쟁을 원만하게 해결하기 위하여 필요한 모든 노력을 하여야 합니다.
2. 본 약관과 관련된 분쟁에 관한 소송은 대한민국 법을 준거법으로 하며, 회사의 소재지를 관할하는 법원을 전속 관할 법원으로 합니다.

부칙
본 약관은 2025년 1월 1일부터 시행합니다.
"""
    },
    "privacy_required": {
        "title": "서비스 가입을 위한 개인정보 수집·이용 동의서",
        "required": True,
        "content": """
CarePlus(이하 "회사")는 「개인정보 보호법」 제15조 제1항 제1호, 제17조 제1항 제1호, 제23조 제1호, 제24조 제1항 제1호에 따라 아래와 같이 개인정보의 수집·이용에 관하여 귀하의 동의를 얻고자 합니다.

1. 개인정보의 수집 및 이용 목적
회사는 수집한 개인정보를 다음의 목적을 위해 활용합니다.
- 서비스 제공 계약의 성립, 유지, 종료를 위한 본인 식별 및 실명확인
- 회원 관리: 회원제 서비스 이용에 따른 본인확인, 개인 식별, 불량회원의 부정 이용 방지와 비인가 사용 방지
- 서비스 제공: 만성콩팥병 관리 서비스, 건강 상담, 의료정보 제공, 건강기록 관리
- 고충처리: 민원사항 확인, 사실조사를 위한 연락·통지, 처리결과 통보

2. 수집하는 개인정보의 항목
- 필수항목: 이름, 이메일, 비밀번호, 생년월일, 휴대전화번호
- 선택항목: 성별, 주소
- 서비스 이용과정에서 자동으로 생성되어 수집될 수 있는 정보: 접속 로그, 쿠키, 접속 IP 정보, 서비스 이용 기록

3. 개인정보의 보유 및 이용 기간
회원 탈퇴 시까지 또는 최종 로그인으로부터 2년간 보유하며, 기간 경과 시 지체 없이 파기합니다.
단, 관계법령의 규정에 의하여 보존할 필요가 있는 경우 회사는 아래와 같이 관계법령에서 정한 일정한 기간 동안 회원정보를 보관합니다.
- 계약 또는 청약철회 등에 관한 기록: 5년 (전자상거래 등에서의 소비자보호에 관한 법률)
- 대금결제 및 재화 등의 공급에 관한 기록: 5년 (전자상거래 등에서의 소비자보호에 관한 법률)
- 소비자의 불만 또는 분쟁처리에 관한 기록: 3년 (전자상거래 등에서의 소비자보호에 관한 법률)
- 본인확인에 관한 기록: 6개월 (정보통신망 이용촉진 및 정보보호 등에 관한 법률)
- 방문에 관한 기록: 3개월 (통신비밀보호법)

4. 동의를 거부할 권리 및 동의를 거부할 경우의 불이익
귀하는 위와 같은 개인정보를 제공하는데 대한 동의를 거부할 권리가 있습니다. 그러나 동의를 거부하는 경우 서비스 이용에 제한을 받을 수 있습니다.
"""
    },
    "privacy_optional": {
        "title": "서비스 가입을 위한 개인정보 수집·이용 동의서",
        "required": False,
        "content": """
CarePlus(이하 "회사")는 「개인정보 보호법」 제15조 제1항 제1호, 제17조 제1항 제1호에 따라 아래와 같이 개인정보의 수집·이용에 관하여 귀하의 동의를 얻고자 합니다.

1. 개인정보의 수집 및 이용 목적
- 맞춤형 서비스 제공
- 서비스 이용에 대한 통계 분석
- 새로운 서비스 개발 및 마케팅

2. 수집하는 개인정보의 항목
- 선택항목: 이메일 주소, 관심 질환 정보, 건강 관련 선호도

3. 개인정보의 보유 및 이용 기간
회원 탈퇴 시 또는 동의 철회 시까지 보유하며, 기간 경과 시 지체 없이 파기합니다.

4. 동의를 거부할 권리 및 동의를 거부할 경우의 불이익
귀하는 위와 같은 개인정보를 제공하는데 대한 동의를 거부할 권리가 있습니다. 동의를 거부하더라도 기본 서비스 이용에는 제한이 없으나, 맞춤형 서비스 제공에 제한을 받을 수 있습니다.
"""
    },
    "marketing": {
        "title": "마케팅을 위한 수집 시 동의",
        "required": False,
        "content": """
CarePlus(이하 "회사")는 「개인정보 보호법」 제22조 제4항에 따라 아래와 같이 마케팅 목적의 개인정보 수집·이용에 관하여 귀하의 동의를 얻고자 합니다.

1. 개인정보의 수집 및 이용 목적
- 신규 서비스 및 이벤트 정보 안내
- 맞춤형 건강정보 및 의료정보 제공
- 설문조사 및 프로모션 참여 기회 제공

2. 수집하는 개인정보의 항목
- 이메일 주소, 휴대전화번호

3. 개인정보의 보유 및 이용 기간
동의일로부터 회원 탈퇴 시 또는 마케팅 동의 철회 시까지

4. 동의를 거부할 권리 및 동의를 거부할 경우의 불이익
귀하는 위와 같은 개인정보를 제공하는데 대한 동의를 거부할 권리가 있습니다. 동의를 거부하더라도 서비스 이용에는 제한이 없으나, 마케팅 정보 수신 및 이벤트 참여에 제한을 받을 수 있습니다.

5. 마케팅 정보 수신 동의 철회
회원은 언제든지 회원정보 수정 또는 고객센터를 통해 마케팅 정보 수신 동의를 철회할 수 있습니다.
"""
    }
}


# ==================== API Models ====================

class TermsResponse(BaseModel):
    """Terms of service response"""
    status: str
    terms: Dict[str, Any]


# ==================== API Endpoints ====================

@router.get("/all")
async def get_all_terms() -> TermsResponse:
    """
    Get all terms and conditions (cached)

    Returns all terms content including:
    - Service terms (required)
    - Privacy policy for required information (required)
    - Privacy policy for optional information (optional)
    - Marketing consent (optional)
    """
    logger.info("Returning cached terms content")

    return TermsResponse(
        status="success",
        terms=TERMS_CONTENT
    )


@router.get("/health")
async def health_check():
    """Health check endpoint"""
    return {
        "status": "healthy",
        "service": "terms_api",
        "cached_terms": len(TERMS_CONTENT)
    }
